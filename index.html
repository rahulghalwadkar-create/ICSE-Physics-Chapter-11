<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermal Titan - ICSE Class 10 Physics</title>
    <style>
        :root {
            /* Theme: Heat/Thermodynamics (Red/Orange/Gold) */
            --color-primary: #FF5722; 
            --color-secondary: #FF9800;
            --color-success: #2E7D32;
            --color-danger: #D32F2F;
            --color-warning: #FFC107;
            --color-bg: #fff3e0;
            --color-card: #ffffff;
            --color-text: #212121;
            --color-border: #ffccbc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            /* Warm gradient for Heat theme */
            background: linear-gradient(135deg, #FF512F 0%, #DD2476 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            background: var(--color-card);
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 5px solid var(--color-primary);
        }

        .header h1 {
            color: var(--color-danger);
            font-size: 2.5em;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .header p {
            color: #555;
            font-size: 1.1em;
        }

        .stats-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat-card {
            flex: 1;
            min-width: 150px;
            background: var(--color-card);
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
            border-top: 3px solid var(--color-secondary);
        }

        .stat-card h3 {
            font-size: 0.9em;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
        }

        .stat-card .value {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--color-primary);
        }

        .game-container {
            background: var(--color-card);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            min-height: 400px;
        }

        .menu-screen, .level-screen, .quiz-screen, .result-screen {
            display: none;
        }

        .menu-screen.active, .level-screen.active, .quiz-screen.active, .result-screen.active {
            display: block;
        }

        .level-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .level-card {
            background: linear-gradient(135deg, #FF5722 0%, #FF9800 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 4px 15px rgba(255, 87, 34, 0.3);
            position: relative;
            overflow: hidden;
        }

        .level-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(255, 87, 34, 0.5);
        }

        .level-card.locked {
            background: linear-gradient(135deg, #607D8B 0%, #455A64 100%);
            cursor: not-allowed;
            opacity: 0.7;
        }

        .level-card h3 {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .level-card p {
            font-size: 0.95em;
            opacity: 0.95;
        }

        .level-card .stars {
            margin-top: 15px;
            font-size: 1.5em;
        }

        .question-container {
            margin-bottom: 30px;
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--color-border);
        }

        .question-number {
            font-size: 1.2em;
            color: var(--color-primary);
            font-weight: bold;
        }

        .timer {
            font-size: 1.2em;
            color: var(--color-danger);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .question-text {
            font-size: 1.3em;
            color: var(--color-text);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        /* Support for superscripts in questions */
        sup { font-size: 0.7em; }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            background: #fff8f5;
            border: 2px solid var(--color-border);
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1.1em;
        }

        .option:hover {
            background: #ffebe5;
            border-color: var(--color-primary);
            transform: translateX(5px);
        }

        .option.selected {
            background: var(--color-primary);
            color: white;
            border-color: var(--color-primary);
        }

        .option.correct {
            background: var(--color-success);
            color: white;
            border-color: var(--color-success);
        }

        .option.incorrect {
            background: var(--color-danger);
            color: white;
            border-color: var(--color-danger);
        }

        .option.disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        .btn {
            padding: 12px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #E64A19;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 87, 34, 0.4);
        }

        .btn-success {
            background: var(--color-success);
            color: white;
        }

        .btn-success:hover {
            background: #256628;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 25px;
            flex-wrap: wrap;
        }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 1.05em;
        }

        .feedback.correct {
            background: #e8f5e9;
            color: #1b5e20;
            border: 1px solid #c8e6c9;
        }

        .feedback.incorrect {
            background: #ffebee;
            color: #b71c1c;
            border: 1px solid #ffcdd2;
        }

        .result-summary {
            text-align: center;
            padding: 30px;
        }

        .result-summary h2 {
            font-size: 2.5em;
            margin-bottom: 20px;
            color: var(--color-primary);
        }

        .result-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .result-stat {
            background: #fff8f5;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid var(--color-border);
        }

        .result-stat h3 {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 10px;
        }

        .result-stat .value {
            font-size: 2em;
            font-weight: bold;
            color: var(--color-primary);
        }

        .badge {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: bold;
            margin: 10px 5px;
            font-size: 0.9em;
        }

        .badge-gold { background: #FFD700; color: #333; box-shadow: 0 0 10px #FFD700; }
        .badge-silver { background: #E0E0E0; color: #333; }
        .badge-bronze { background: #CD7F32; color: white; }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #eeeeee;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--color-secondary), var(--color-primary));
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .header h1 { font-size: 1.8em; }
            .stats-bar { flex-direction: column; }
            .level-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üî• Thermal Titan</h1>
            <p>ICSE Class 10 Physics - Chapter 11: Calorimetry</p>
        </div>

        <div class="stats-bar">
            <div class="stat-card">
                <h3>Total Heat Points</h3>
                <div class="value" id="totalScore">0</div>
            </div>
            <div class="stat-card">
                <h3>Levels Cleared</h3>
                <div class="value" id="levelsCompleted">0/5</div>
            </div>
            <div class="stat-card">
                <h3>Efficiency</h3>
                <div class="value" id="accuracy">0%</div>
            </div>
            <div class="stat-card">
                <h3>Badges</h3>
                <div class="value" id="badges">0</div>
            </div>
        </div>

        <div class="game-container">
            <div class="menu-screen active" id="menuScreen">
                <h2 style="text-align: center; margin-bottom: 30px; color: var(--color-primary); font-size: 2em;">Select Your Simulation</h2>
                <div class="level-grid" id="levelGrid"></div>
            </div>

            <div class="quiz-screen" id="quizScreen">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="question-container">
                    <div class="question-header">
                        <span class="question-number" id="questionNumber">Question 1 of 5</span>
                        <span class="timer" id="timer">‚è±Ô∏è 45s</span>
                    </div>
                    <div class="question-text" id="questionText"></div>
                    <div class="options" id="optionsContainer"></div>
                    <div class="feedback" id="feedback" style="display: none;"></div>
                </div>
                <div class="button-group">
                    <button class="btn btn-primary" id="nextBtn" style="display: none;">Next Phase</button>
                    <button class="btn btn-success" id="finishBtn" style="display: none;">Analyze Results</button>
                </div>
            </div>

            <div class="result-screen" id="resultScreen">
                <div class="result-summary">
                    <h2 id="resultTitle">üéâ Simulation Complete!</h2>
                    <div class="result-stats">
                        <div class="result-stat">
                            <h3>Score</h3>
                            <div class="value" id="resultScore">0</div>
                        </div>
                        <div class="result-stat">
                            <h3>Correct Answers</h3>
                            <div class="value" id="resultCorrect">0/5</div>
                        </div>
                        <div class="result-stat">
                            <h3>Time Taken</h3>
                            <div class="value" id="resultTime">0s</div>
                        </div>
                        <div class="result-stat">
                            <h3>Accuracy</h3>
                            <div class="value" id="resultAccuracy">0%</div>
                        </div>
                    </div>
                    <div id="badgeContainer"></div>
                    <div class="button-group" style="justify-content: center;">
                        <button class="btn btn-primary" id="retryBtn">Retry Level</button>
                        <button class="btn btn-success" id="menuBtn">Lab Menu</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const gameData = {
            levels: [
                {
                    id: 1,
                    title: "Heat vs. Temp",
                    description: "Units, Concepts & Basics",
                    locked: false,
                    stars: 0,
                    questions: [
                        {
                            question: "What is the S.I. unit of Heat?",
                            options: [
                                "Calorie",
                                "Joule",
                                "Kelvin",
                                "Celsius"
                            ],
                            correct: 1,
                            explanation: "Heat is a form of energy, so its S.I. unit is Joule (J). Kelvin is the unit of temperature."
                        },
                        {
                            question: "1 Calorie is equal to approximately:",
                            options: [
                                "4.2 Joules",
                                "1000 Joules",
                                "0.42 Joules",
                                "273 Joules"
                            ],
                            correct: 0,
                            explanation: "1 calorie is the heat needed to raise 1g of water by 1¬∞C. 1 cal ‚âà 4.186 J (rounded to 4.2 J)."
                        },
                        {
                            question: "Temperature determines:",
                            options: [
                                "The total energy in a body",
                                "The direction of flow of heat",
                                "The mass of the body",
                                "The state of matter only"
                            ],
                            correct: 1,
                            explanation: "Heat always flows from a body at a higher temperature to a body at a lower temperature."
                        },
                        {
                            question: "What is the relationship between Heat Capacity (C') and Specific Heat Capacity (c)?",
                            options: [
                                "C' = m/c",
                                "C' = m √ó c",
                                "c = m √ó C'",
                                "C' = c"
                            ],
                            correct: 1,
                            explanation: "Heat Capacity is for the whole body, while Specific Heat is for unit mass. So, C' = mass √ó specific heat."
                        },
                        {
                            question: "Which of the following has the highest Specific Heat Capacity?",
                            options: [
                                "Copper",
                                "Water",
                                "Mercury",
                                "Sand"
                            ],
                            correct: 1,
                            explanation: "Water has a very high specific heat capacity (4200 J/kgK), making it an excellent coolant."
                        }
                    ]
                },
                {
                    id: 2,
                    title: "Specific Heat",
                    description: "Calculations: Q = mcŒîT",
                    locked: true,
                    stars: 0,
                    questions: [
                        {
                            question: "Calculate the heat energy required to raise the temperature of 2 kg of water from 10¬∞C to 50¬∞C. (c = 4200 J/kgK)",
                            options: [
                                "168,000 J",
                                "336,000 J",
                                "84,000 J",
                                "42,000 J"
                            ],
                            correct: 1,
                            explanation: "Q = mcŒîT = 2 √ó 4200 √ó (50-10) = 2 √ó 4200 √ó 40 = 336,000 J."
                        },
                        {
                            question: "Why is water used as a coolant in car radiators?",
                            options: [
                                "It boils easily",
                                "It conducts heat poorly",
                                "It extracts a large amount of heat with small temp rise",
                                "It is transparent"
                            ],
                            correct: 2,
                            explanation: "Due to its high specific heat capacity, water can absorb a lot of heat without becoming dangerously hot itself."
                        },
                        {
                            question: "Two copper spheres of equal mass are heated. Sphere A rises by 10¬∞C, Sphere B by 20¬∞C. Which absorbed more heat?",
                            options: [
                                "Sphere A",
                                "Sphere B",
                                "Both absorbed same heat",
                                "Cannot be determined"
                            ],
                            correct: 1,
                            explanation: "Since Q = mcŒîT, and m and c are same, Q is proportional to ŒîT. Sphere B had a larger temp rise, so it absorbed more heat."
                        },
                        {
                            question: "The S.I. unit of Specific Heat Capacity is:",
                            options: [
                                "J kg‚Åª¬π",
                                "J K‚Åª¬π",
                                "J kg‚Åª¬π K‚Åª¬π",
                                "cal g‚Åª¬π"
                            ],
                            correct: 2,
                            explanation: "Specific Heat Capacity is energy per unit mass per unit temperature: Joules per kg per Kelvin."
                        },
                        {
                            question: "Land breeze and Sea breeze are formed due to:",
                            options: [
                                "Difference in density of air",
                                "Difference in specific heat capacity of land and water",
                                "Magnetic field of earth",
                                "Rotation of earth"
                            ],
                            correct: 1,
                            explanation: "Water heats up and cools down slower than land due to high specific heat, creating pressure differences and breezes."
                        }
                    ]
                },
                {
                    id: 3,
                    title: "Phase Change",
                    description: "Latent Heat & State Change",
                    locked: true,
                    stars: 0,
                    questions: [
                        {
                            question: "During the melting of ice at 0¬∞C, the temperature:",
                            options: [
                                "Increases",
                                "Decreases",
                                "Remains constant",
                                "Fluctuates"
                            ],
                            correct: 2,
                            explanation: "During a phase change, heat supplied is used to break intermolecular bonds (Latent Heat), so kinetic energy (temperature) remains constant."
                        },
                        {
                            question: "The specific latent heat of fusion of ice is approximately:",
                            options: [
                                "336 J/g",
                                "4200 J/g",
                                "2260 J/g",
                                "4.2 J/g"
                            ],
                            correct: 0,
                            explanation: "It takes 336 J of heat to melt 1g of ice at 0¬∞C to water at 0¬∞C."
                        },
                        {
                            question: "Why do we feel cooler when sweat evaporates?",
                            options: [
                                "Sweat is cold",
                                "Evaporation requires latent heat, taken from the body",
                                "Air pressure drops",
                                "Water has low conductivity"
                            ],
                            correct: 1,
                            explanation: "Evaporation requires Latent Heat of Vaporization. This heat is extracted from the skin, causing a cooling effect."
                        },
                        {
                            question: "10g of ice at 0¬∞C absorbs 3360 J of heat. What is the final state?",
                            options: [
                                "Ice at -10¬∞C",
                                "Water at 10¬∞C",
                                "Water at 0¬∞C",
                                "Steam"
                            ],
                            correct: 2,
                            explanation: "Q = mL. For ice, L = 336 J/g. Q required to melt 10g = 10 √ó 336 = 3360 J. Since exactly this amount is supplied, it becomes water at 0¬∞C."
                        },
                        {
                            question: "Steam causes more severe burns than boiling water at 100¬∞C because:",
                            options: [
                                "Steam is hotter than 100¬∞C",
                                "Steam penetrates skin deeper",
                                "Steam possesses extra latent heat",
                                "Steam is a gas"
                            ],
                            correct: 2,
                            explanation: "Steam at 100¬∞C has 2260 J/g more heat energy (latent heat of vaporization) than water at 100¬∞C."
                        }
                    ]
                },
                {
                    id: 4,
                    title: "Calorimetry",
                    description: "Principle of Mixtures",
                    locked: true,
                    stars: 0,
                    questions: [
                        {
                            question: "The Principle of Calorimetry is based on the Law of Conservation of:",
                            options: [
                                "Mass",
                                "Energy",
                                "Momentum",
                                "Charge"
                            ],
                            correct: 1,
                            explanation: "Heat Lost = Heat Gained implies that energy is neither created nor destroyed, only transferred."
                        },
                        {
                            question: "If a hot body is mixed with a cold body (no external loss), then:",
                            options: [
                                "Heat lost by hot body > Heat gained by cold body",
                                "Heat lost by hot body < Heat gained by cold body",
                                "Heat lost by hot body = Heat gained by cold body",
                                "Temperature of both becomes 0¬∞C"
                            ],
                            correct: 2,
                            explanation: "This is the fundamental Principle of Method of Mixtures."
                        },
                        {
                            question: "Why are calorimeters made of thin copper sheets?",
                            options: [
                                "Copper is cheap",
                                "Copper has low specific heat capacity",
                                "Copper is an insulator",
                                "Copper is transparent"
                            ],
                            correct: 1,
                            explanation: "Copper is a good conductor and has low specific heat, so the calorimeter itself absorbs very little heat from the contents."
                        },
                        {
                            question: "When hot water is mixed with cold water, the final temperature will be:",
                            options: [
                                "Higher than the hot water",
                                "Lower than the cold water",
                                "Between the hot and cold temperatures",
                                "Equal to the difference of temperatures"
                            ],
                            correct: 2,
                            explanation: "The mixture reaches an equilibrium temperature somewhere between the two initial temperatures."
                        },
                        {
                            question: "In the equation Heat Lost = Heat Gained, heat lost is calculated as:",
                            options: [
                                "mc(T_final - T_initial)",
                                "mc(T_hot - T_mix)",
                                "mL",
                                "m/c"
                            ],
                            correct: 1,
                            explanation: "For the hot body losing heat, the temperature drop is (Initial Hot Temp - Final Mixture Temp)."
                        }
                    ]
                },
                {
                    id: 5,
                    title: "Thermal Master",
                    description: "Advanced Problems",
                    locked: true,
                    stars: 0,
                    questions: [
                        {
                            question: "A heater of power 50W runs for 10 seconds. How much heat is produced?",
                            options: [
                                "5 J",
                                "50 J",
                                "500 J",
                                "0.2 J"
                            ],
                            correct: 2,
                            explanation: "Energy = Power √ó Time. E = 50 W √ó 10 s = 500 Joules."
                        },
                        {
                            question: "Which represents the heating curve of ice to steam?",
                            options: [
                                "A straight diagonal line",
                                "Steps with plateaus (flat parts) at 0¬∞C and 100¬∞C",
                                "A curved exponential line",
                                "A vertical line"
                            ],
                            correct: 1,
                            explanation: "The temperature stays constant during melting (0¬∞C) and boiling (100¬∞C), creating flat plateaus on the graph."
                        },
                        {
                            question: "If the specific heat capacity of a substance is low, it means:",
                            options: [
                                "It takes a lot of heat to raise its temperature",
                                "Its temperature rises rapidly when heated",
                                "It is a good insulator",
                                "It melts easily"
                            ],
                            correct: 1,
                            explanation: "Low specific heat means it needs very little energy to get hot, so its temperature rises quickly."
                        },
                        {
                            question: "What is the global warming potential of water vapor?",
                            options: [
                                "It is a greenhouse gas",
                                "It cools the earth",
                                "It has no effect",
                                "It destroys ozone"
                            ],
                            correct: 0,
                            explanation: "Water vapor is a greenhouse gas due to its ability to absorb thermal radiation (high heat capacity), though it is natural."
                        },
                        {
                            question: "40g of hot water at 60¬∞C is added to 100g of cold water at 10¬∞C. Calculate final temp (approx).",
                            options: [
                                "35¬∞C",
                                "24¬∞C",
                                "50¬∞C",
                                "15¬∞C"
                            ],
                            correct: 1,
                            explanation: "40(60-T) = 100(T-10) => 2400-40T = 100T-1000 => 3400 = 140T => T ‚âà 24.2¬∞C."
                        }
                    ]
                }
            ]
        };

        let currentLevel = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let correctAnswers = 0;
        let timeRemaining = 45; // Increased time for calculation
        let timerInterval = null;
        let totalAttempts = 0;
        let totalCorrect = 0;
        let startTime = 0;

        // Initialize game
        function initGame() {
            loadProgress();
            renderLevelGrid();
            updateStats();
        }

        function renderLevelGrid() {
            const levelGrid = document.getElementById('levelGrid');
            levelGrid.innerHTML = '';

            gameData.levels.forEach(level => {
                const levelCard = document.createElement('div');
                levelCard.className = `level-card ${level.locked ? 'locked' : ''}`;
                levelCard.innerHTML = `
                    <h3>${level.title}</h3>
                    <p>${level.description}</p>
                    <div class="stars">${'‚≠ê'.repeat(level.stars)}${'‚òÜ'.repeat(3 - level.stars)}</div>
                `;
                if (!level.locked) {
                    levelCard.onclick = () => startLevel(level.id);
                }
                levelGrid.appendChild(levelCard);
            });
        }

        function startLevel(levelId) {
            currentLevel = gameData.levels.find(l => l.id === levelId);
            currentQuestionIndex = 0;
            score = 0;
            correctAnswers = 0;
            startTime = Date.now();

            document.getElementById('menuScreen').classList.remove('active');
            document.getElementById('quizScreen').classList.add('active');
            
            showQuestion();
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentLevel.questions.length) {
                showResults();
                return;
            }

            const question = currentLevel.questions[currentQuestionIndex];
            document.getElementById('questionNumber').textContent = 
                `Question ${currentQuestionIndex + 1} of ${currentLevel.questions.length}`;
            document.getElementById('questionText').innerHTML = question.question; // Changed to innerHTML for subscripts/superscripts
            
            const progress = ((currentQuestionIndex) / currentLevel.questions.length) * 100;
            document.getElementById('progressFill').style.width = progress + '%';

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';

            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.innerHTML = option; // innerHTML for physics units
                optionDiv.onclick = () => selectAnswer(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('feedback').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('finishBtn').style.display = 'none';

            timeRemaining = 45; // Reset timer to 45s for Physics problems
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeRemaining--;
                document.getElementById('timer').textContent = `‚è±Ô∏è ${timeRemaining}s`;
                
                if (timeRemaining <= 0) {
                    clearInterval(timerInterval);
                    selectAnswer(-1); // Time's up
                }
            }, 1000);
        }

        function selectAnswer(selectedIndex) {
            clearInterval(timerInterval);
            
            const question = currentLevel.questions[currentQuestionIndex];
            const options = document.querySelectorAll('.option');
            
            options.forEach((option, index) => {
                option.classList.add('disabled');
                if (index === question.correct) {
                    option.classList.add('correct');
                }
                if (index === selectedIndex && index !== question.correct) {
                    option.classList.add('incorrect');
                }
            });

            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            
            totalAttempts++;
            if (selectedIndex === question.correct) {
                correctAnswers++;
                totalCorrect++;
                const timeBonus = Math.floor(timeRemaining * 3); // Higher time bonus for physics
                score += 100 + timeBonus;
                feedback.className = 'feedback correct';
                feedback.innerHTML = `
                    <strong>‚úÖ Correct!</strong><br>
                    ${question.explanation}<br>
                    <em>+${100 + timeBonus} points (${timeBonus} time bonus)</em>
                `;
            } else {
                feedback.className = 'feedback incorrect';
                feedback.innerHTML = `
                    <strong>‚ùå Incorrect</strong><br>
                    ${question.explanation}
                `;
            }

            if (currentQuestionIndex < currentLevel.questions.length - 1) {
                document.getElementById('nextBtn').style.display = 'inline-block';
            } else {
                document.getElementById('finishBtn').style.display = 'inline-block';
            }
        }

        document.getElementById('nextBtn').onclick = () => {
            currentQuestionIndex++;
            showQuestion();
        };

        document.getElementById('finishBtn').onclick = () => {
            showResults();
        };

        function showResults() {
            clearInterval(timerInterval);
            
            const timeTaken = Math.floor((Date.now() - startTime) / 1000);
            const accuracy = Math.round((correctAnswers / currentLevel.questions.length) * 100);
            
            // Update level stars
            if (accuracy >= 80) currentLevel.stars = 3;
            else if (accuracy >= 60) currentLevel.stars = 2;
            else if (accuracy >= 40) currentLevel.stars = 1;
            
            // Unlock next level
            if (currentLevel.id < gameData.levels.length && currentLevel.stars > 0) {
                gameData.levels[currentLevel.id].locked = false;
            }

            document.getElementById('quizScreen').classList.remove('active');
            document.getElementById('resultScreen').classList.add('active');

            document.getElementById('resultTitle').textContent = 
                accuracy >= 80 ? 'üéâ Thermal Master!' : 
                accuracy >= 60 ? 'üëç Solid Effort!' : 
                accuracy >= 40 ? 'üí™ Getting Warmer!' : 
                'üìö Needs Revision!';

            document.getElementById('resultScore').textContent = score;
            document.getElementById('resultCorrect').textContent = 
                `${correctAnswers}/${currentLevel.questions.length}`;
            document.getElementById('resultTime').textContent = `${timeTaken}s`;
            document.getElementById('resultAccuracy').textContent = `${accuracy}%`;

            // Show badges
            const badgeContainer = document.getElementById('badgeContainer');
            badgeContainer.innerHTML = '';
            
            if (currentLevel.stars === 3) {
                badgeContainer.innerHTML += '<span class="badge badge-gold">üèÜ Heat Shield</span>';
            } else if (currentLevel.stars === 2) {
                badgeContainer.innerHTML += '<span class="badge badge-silver">ü•à Lab Assistant</span>';
            } else if (currentLevel.stars === 1) {
                badgeContainer.innerHTML += '<span class="badge badge-bronze">ü•â Intern</span>';
            }

            if (timeTaken < 60) {
                badgeContainer.innerHTML += '<span class="badge badge-gold">‚ö° Rapid Reaction</span>';
            }

            saveProgress();
            updateStats();
        }

        document.getElementById('retryBtn').onclick = () => {
            document.getElementById('resultScreen').classList.remove('active');
            startLevel(currentLevel.id);
        };

        document.getElementById('menuBtn').onclick = () => {
            document.getElementById('resultScreen').classList.remove('active');
            document.getElementById('menuScreen').classList.add('active');
            renderLevelGrid();
        };

        function updateStats() {
            const levelsCompleted = gameData.levels.filter(l => l.stars > 0).length;
            const totalStars = gameData.levels.reduce((sum, l) => sum + l.stars, 0);
            const accuracy = totalAttempts > 0 ? Math.round((totalCorrect / totalAttempts) * 100) : 0;

            document.getElementById('totalScore').textContent = totalStars * 150; // Points scaling
            document.getElementById('levelsCompleted').textContent = `${levelsCompleted}/5`;
            document.getElementById('accuracy').textContent = `${accuracy}%`;
            document.getElementById('badges').textContent = 
                gameData.levels.filter(l => l.stars === 3).length;
        }

        function saveProgress() {
            const progress = {
                levels: gameData.levels.map(l => ({
                    id: l.id,
                    locked: l.locked,
                    stars: l.stars
                })),
                totalAttempts,
                totalCorrect
            };
            // Unique key for this game
            localStorage.setItem('calorimetryQuestProgress', JSON.stringify(progress));
        }

        function loadProgress() {
            const saved = localStorage.getItem('calorimetryQuestProgress');
            if (saved) {
                const progress = JSON.parse(saved);
                progress.levels.forEach(saved => {
                    const level = gameData.levels.find(l => l.id === saved.id);
                    if (level) {
                        level.locked = saved.locked;
                        level.stars = saved.stars;
                    }
                });
                totalAttempts = progress.totalAttempts || 0;
                totalCorrect = progress.totalCorrect || 0;
            }
        }

        // Initialize on page load
        initGame();
    </script>
</body>
</html>